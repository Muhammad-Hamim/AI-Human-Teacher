
> server_side@1.0.0 start:dev
> ts-node-dev --respawn --transpile-only ./src/server.ts

[INFO] 06:15:30 ts-node-dev ver. 2.0.0 (using ts-node ver. 10.9.2, typescript ver. 5.8.2)
ğŸ”— Database connection established
Explicitly enabling poetry training
Initializing AI Factory with poem database context...
Environment variables: POETRY_TRAINING = true
All collections in database:
- messages
- users
- poems
- chats
Found potential poem collection: poems with 53 documents
Sample document: {
  "_id": "67dab764bca3c7c7ef8eccda",
  "title": "é™å¤œæ€",
  "author": "æç™½",
  "dynasty": "å”"
}
Found potential poem collection: chats with 19 documents
Sample document: {
  "_id": "67db68cf4eb013902e579398",
  "title": "tell a chinese poem."
}
Searching for poem collections for context generation...
Using collection 'poems' with 53 poems for context generation
Poem database context generated:
-----------------------------
POEM DATABASE INFORMATION:

Total poems: 53
Dynasties represented: 4
Authors represented: 17

Sample poems in database:
- "é™å¤œæ€" by æç™½ (å”)
- "é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µ" by æç™½ (å”)
- "èµ æ±ªä¼¦" by æç™½ (å”)
- "é€æœå°‘åºœä¹‹ä»»èœ€å·" by ç‹å‹ƒ (å”)
- "ä¹æœˆä¹æ—¥å¿†å±±ä¸œå…„å¼Ÿ" by ç‹ç»´ (å”)
- "ç¦»éªš" by å±ˆåŸ (æˆ˜å›½)
- "å¤œé›¨å¯„åŒ—" by æå•†éš (å”)
- "ç™»å²³é˜³æ¥¼" by æœç”« (å”)
- "å‡‰å·è¯" by ç‹ä¹‹æ¶£ (å”)
- "æ±Ÿé›ª" by æŸ³å®—å…ƒ (å”)

-----------------------------
AI Factory initialized successfully with poem database context
ğŸš€ Server running on port 5000
ğŸ“¢ Server accessible at: http://localhost:5000
Server base URL set to: http://localhost:5000
Server base URL set to: http://localhost:5000
Server base URL set to: http://localhost:5000
AI services initialized
Loaded 0 TTS voices
ğŸ™ï¸ Generating TTS for test...
ğŸ“œ Detected Chinese poem format:
- Has line breaks: true
- Has Chinese punctuation: true
- Has short lines: true
- Has balanced line length: true
- Sample of poem: é™å¤œæ€
åºŠå‰æ˜æœˆå…‰ï¼Œ
ç–‘æ˜¯åœ°ä¸Šéœœã€‚
ä¸¾å¤´æœ›æ˜æœˆï¼Œ
ä½å¤´æ€æ•…ä¹¡ã€‚
ğŸ“ Applying special poem formatting
ğŸ™ï¸ Formatted poem for TTS: é™å¤œæ€ã€‚ã€‚åºŠå‰æ˜æœˆå…‰ï¼Œã€‚ç–‘æ˜¯åœ°ä¸Šéœœã€‚ã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œã€‚ä½å¤´æ€æ•…ä¹¡ã€‚
âœ… TTS generation successful: /dist/tts-test-1743200296495.wav
ğŸ™ï¸ Generating TTS for test...
ğŸ“œ Detected Chinese poem format:
- Has line breaks: true
- Has Chinese punctuation: true
- Has short lines: true
- Has balanced line length: true
- Sample of poem: é™å¤œæ€
åºŠå‰æ˜æœˆå…‰ï¼Œ
ç–‘æ˜¯åœ°ä¸Šéœœã€‚
ä¸¾å¤´æœ›æ˜æœˆï¼Œ
ä½å¤´æ€æ•…ä¹¡ã€‚
ğŸ“ Applying special poem formatting
ğŸ™ï¸ Formatted poem for TTS: é™å¤œæ€ã€‚ã€‚åºŠå‰æ˜æœˆå…‰ï¼Œã€‚ç–‘æ˜¯åœ°ä¸Šéœœã€‚ã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œã€‚ä½å¤´æ€æ•…ä¹¡ã€‚
âœ… TTS generation successful: /dist/tts-test-1743200353449.wav
ğŸ” message {
  message: {
    user: { senderId: '641e23bc79b28a2f9c8d4567', senderType: 'user' },
    message: { content: 'tell me a modern chinese poem', contentType: 'text' },
    chatId: '67e5473309c378caddbd141f',
    isAIResponse: false,
    userId: '641e23bc79b28a2f9c8d4567',
    isDeleted: false
  },
  modelName: 'deepseek/deepseek-r1:free',
  options: { temperature: 1, maxToken: 2000 }
}
Using default Poem model
Adding poem database context to conversation:
Context length: 322
Checking if message is poem-related: "tell me a modern chinese poem"
Is poem query: true
Processing random poem request
Retrieved random poem: "çµç¶è¡Œ" by ç™½å±…æ˜“
Adding specific poem context based on query:
Query: tell me a modern chinese poem
Context length: 2091
